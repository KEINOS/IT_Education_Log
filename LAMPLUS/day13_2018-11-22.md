20181122 教育内容

## 復習と詳細な説明

- 「Python3 でブロックチェーン」の流れ
- ブロック・オブジェクトをリストに加えて行く

### ハッシュ関数

- ハッシュ関数の特徴
    1. 入力された値が同じ場合、戻り値も同じとなる
    2. 入力された値の長さに関わらず、戻り値はどれも同じ長さとなる
    3. 戻り値から、入力された値を算出することはほぼ不可能（非現実的）
        - 辞書攻撃で（対応表から）導き出すことは可能であるが算出は難しい

- ハッシュ関数の例

    - ` hash(<アルゴリズム>, データ)`  -> ハッシュ値

- MD5, SHA1, SHA256, SHA512 , etc.
    - コリジョン（衝突）
        - ハッシュ関数におけるコリジョン
            - a !== b において
            - hash('md5', a ) == hash('md5', b) が true となる a と b をコリジョンという
        - 衝突の怖さ＝改ざん
            - a = 正しいデータ
            - b = 改ざんデータ
            - salt = 改ざんを隠蔽するゴミデータ
            - hash('md5', a ) == hash('md5', b + salt) となる salt の値を探す

- salt（塩）

    - 塩加減で料理の味が変わる
    
        誰でも同じ味が出せる（パスワード保存で危険なタイプ）
        ```
        dish1 = hash('md5', a)
        dish2 = hash('md5', a)
        ```

        塩加減がわからないと同じ味が出せない
        ```
        dish1 = hash('md5', a + salt1)
        dish2 = hash('md5', a + salt2)
        ```
    
    - 例えば Web の場合 Cookie によるログイン・セッションなどに使われる
        - 全員を一斉ログアウトさせたい
            - ログイン済み SESSION_ID = hash('md5', ID + salt ) であった場合、salt 値を変更する。IDの値は変わらないことに注目。（本当はもっと複雑）

- 総当たり攻撃
    - ハッシュの場合は、ハッシュ値が同じになるように、総当たりで計算すること
        1. ハッシュ関数の**引数全体を総当たり**する
        2. ハッシュ関数の**salt 値を総当たり**する
    - 実はブロックチェーンの改ざんを防ぐ方法に利用されている
        - nonce, マイニング

- ゲーム

ハッシュ値（ハッシュ結果） result の最初の2文字が "00" で始まる salt を探せ。

```
import hashlib as hasher

data = 'hoge'
salt = ???
md5  = hasher.md5()
md5.update(data + salt.encode('utf-8'))
result = md5.hexdigest()
```
```python
# coding: utf-8

import hashlib as hasher

data = 'hoge'
salt = 1
find = '000' # 難易度

def hash_md5(salt):
    data = 'hoge'
    md5  = hasher.md5()
    md5.update( (str(data) + str(salt)).encode('utf-8'))
    result = md5.hexdigest()
    return result

def get_len_findChars(value, find):
    slice_value = value[0:len(find)] 
    return slice_value

#print(getHead2Chars('12345'))

while True:
    salt   = salt + 1
    result = hash_md5(salt)
    found  = get_len_findChars(result, find)
    if find == found :
        break

print(f'Salt found {salt}')
print(hash_md5(salt))
```
これがマイニングと同じ仕組み。

### ブロックチェーンと仮想通貨を説明してみよう

- なぜ金属がお金として価値があるのかが理解できないと為替やFX取引は難しい
- なぜ株（証券）という紙が価値があるのかが理解できないと株の取引は難しい
- いずれも理解の前に「投資」が出てくるとうさんくさいもの
    - ビットコインも同じ

- ブロックチェーンとは
    - 台帳（会計帳簿）に例えるとわかりやすい
        -  台帳の一行（日付、支出額、収入額、、、etc）の横に台帳改ざん防止番号をつけるようなもの
            台帳改ざん防止番号は前回（一行前）の値（日付、支出額、収入額、台帳改ざん防止番号、、、etc）を元に作られる。
            そのため台帳の途中を改ざんすると台帳改ざん防止番号も変わってくる→整合性が取れなくなる → 改ざんがわかる。
            改ざんをするには、改ざん後からの台帳改ざん防止番号を全て作り直す必要があり、とても手間がかかる。
    - 台帳管理の改ざんの「手間がかかる」詳細理由
        - 「台帳改ざん防止番号」自体はハッシュ関数ですぐに算出できてしまうが、実際にはnonce（ナンス）を前回の値に足してからハッシュ値にしている。
           例）前回（一行前）の値（日付+支出額+収入額+台帳改ざん防止番号+nonce）
            - nonce（number used once）とは
                - ブロック生成のときに一度だけ使う「使い捨ての数値」、マイニングで解かれる「計算問題の答え」
                - http://virtual-coiner.info/mean/nonce/
- 次回もう一回説明できるように復習しておいてください

###用語
- ハードコーディング
    - 別の場所に分けて書いた方が良い処理や値をソースコードの中に直接書くこと。
      他の人がパッと見たときに分かりにくく、後から変更するのが大変な場合があり使うべきではない。
    - 通常プログラムを書くときは他の人が見ても分かりやすく、後から変更するのが楽なように、できるだけ同じような書き方を考慮する必要がある。
          
- マジック・ナンバー
    - ソース内に埋め込まれたプログラマ本人にしか意味が分からない数値のこと。
      ハードコーディングと同様避けるべきで使ってはいけない。

### JSON ファイルの追記

- 前回「Python JSONファイル 追記」でピンポイントで検索が出なかった理由
    - 処理の対象をJSON ファイルのみにして検索していた。JSONライブラリにある関数で実行可能と思い込んでいた。→ ファイルオブジェクトを読み書きする関数を使用する。
    - ハードディスクのヘッドが書き込む位置に移動するように、python3でファイルに追記する場合も書き込む位置を指定する必要がある。
    - Python3 ドキュメントから対象（ファイル・オブジェクト）のメソッドで使えそうなものを探す。そのメソッド名を元に検索する。    

- JSON ファイルとは
    - JSON 配列の構文（書き方）を知ろう

1. ファイルの最後の文字（]）を削除
    - 配列を開けている（解放する）
2. コンマをつける
3. 新しい JSON 要素を加える
4. ファイルの最後に文字（]）を加える
    - 配列を閉じる

- 詳しくは Qiita を参照
    https://qiita.com/KEINOS/items/ea4bda15506bbd3e6913

## 課題
1. train_Muscle.pyで、筋トレ実施日をログに残すようにJSON ファイルの最後に追記してみる
2. 1ができたら、JSON ファイルの最後の一行のみ読み込む方法を考える
3. 2ができたらハッシュ値も書き込めるようにトライしてみる
